!function(e){var t={_reset:function(t){var n=t;n.find("option").remove().end().append(e("<option>").val("").text(n.data("jsonselect").empty_text))},load:function(n){var a=n,s=null,o=a.data("params");s=e(a.data("parent")),s.length&&(o=e.extend(!0,{},o,{id:s.val()})),e.ajax({url:a.data("url"),dataType:"json",data:o,success:function(n,s,o){t._reset(a);e(n).map(function(){var t=a.data("value"),n=a.data("text");a.append(e("<option>").val(this[t]).text(this[n]))});e.isFunction(a.data("jsonselect").events.success)&&a.data("jsonselect").events.success.call(a,[n,s,o])},beforeSend:function(){e.isFunction(a.data("jsonselect").events.beforeSend)&&a.data("jsonselect").events.beforeSend.call(a)},error:function(t,n,s){e.isFunction(a.data("jsonselect").events.error)&&a.data("jsonselect").events.error.call(a,[t,n,s])}})}};e.fn.jsonselect=function(n){return this.length?(this.each(function(){var a=e(this);if(!a.is("select"))return e.error("Element "+a.attr("name")+" is not an select form control!"),this;if(n=e.extend({},e.fn.jsonselect.defaults,n),a.data("jsonselect",n),a.data("parent")){var s=e(a.data("parent"));s.bind("change",function(){t.load(a)})}a.data("autoload")&&t.load(a)}),this):this},e.fn.jsonselect.defaults={selected:null,empty_text:"Select an option",events:{success:null,beforeSend:null,error:null}}}(jQuery);